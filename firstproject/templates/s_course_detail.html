{% extends 'base.html' %}
{% load static %}

{% block title %}
<title>{{ course.name }} - Course Videos</title>
{% endblock %}

{% block styles %}
<style>
    .video-container {
        display: flex;
        flex-wrap: wrap;
        gap: 2rem;
        margin-top: 2rem;
    }

    .main-player {
        flex: 2;
        min-width: 60%;
    }

    .main-player video,
    .main-player iframe {
        width: 100%;
        height: 450px;
        border-radius: 10px;
    }

    .video-list {
        flex: 1;
        min-width: 300px;
        max-height: 500px;
        overflow-y: auto;
        padding-right: 10px;
    }

    .video-item {
        padding: 10px 15px;
        margin-bottom: 10px;
        background-color: #f8f9fa;
        border-radius: 8px;
        cursor: pointer;
        transition: background-color 0.2s;
    }

    .video-item:hover,
    .video-item.active {
        background-color: #e9ecef;
    }
</style>
{% endblock %}

{% block content %}
<div class="container py-5">
    <h2 class="fw-bold mb-4">{{ course.name }}</h2>

    <div class="video-container">
        <!-- Main Player -->
        <div class="main-player" id="main-player">
            {% if first_video %}
            {% if first_video.file %}
            <video controls id="video-player">
                <source src="{{ first_video.file.url }}" type="video/mp4">
                Your browser does not support the video tag.
            </video>
            {% elif first_video.url %}
            <iframe id="video-player" src="{{ first_video.url }}" frameborder="0" allowfullscreen></iframe>
            {% endif %}
            {% else %}
            <p class="text-muted">No videos available yet.</p>
            {% endif %}
        </div>

        <!-- Video List -->
        <div class="video-list">
            {% for vid in videos %}
            <div class="video-item {% if vid.id == first_video.id %}active{% endif %}"
                data-type="{% if vid.file %}file{% else %}url{% endif %}"
                data-url="{{ vid.file.url|default_if_none:'' }}{{ vid.url|default_if_none:'' }}">
                <strong>{{ forloop.counter }}. {{ vid.title }}</strong><br>
                <small class="text-muted">{{ vid.description|truncatechars:60 }}</small>
            </div>
            {% endfor %}
        </div>
    </div>
</div>

<script>
    const videoItems = document.querySelectorAll('.video-item');
    const mainPlayer = document.getElementById('main-player');

    videoItems.forEach(item => {
        item.addEventListener('click', () => {
            // Remove active from all
            videoItems.forEach(i => i.classList.remove('active'));
            item.classList.add('active');

            const type = item.dataset.type;
            const url = item.dataset.url;

            if (type === 'file') {
                mainPlayer.innerHTML = `
                    <video controls id="video-player">
                        <source src="${url}" type="video/mp4">
                        Your browser does not support the video tag.
                    </video>`;
            } else {
                mainPlayer.innerHTML = `
                    <iframe id="video-player" src="${url}" frameborder="0" allowfullscreen></iframe>`;
            }
        });
    });
</script>
{% endblock %}